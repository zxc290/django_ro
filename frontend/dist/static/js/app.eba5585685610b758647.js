webpackJsonp([1],{"64/T":function(e,t){},AUI1:function(e,t){},"B/tY":function(e,t){},K7ZN:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};r.d(a,"currentUser",function(){return re}),r.d(a,"isLogin",function(){return ae});var n={};r.d(n,"userStatus",function(){return ne}),r.d(n,"userToken",function(){return oe});var o={};r.d(o,"setUser",function(){return le}),r.d(o,"setToken",function(){return ie});var l=r("rVsN"),i=r.n(l),s=r("PVEY"),c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var u=r("C7Lr")({name:"App"},c,!1,function(e){r("AUI1")},null,null).exports,m=r("KGCO"),p=r("aozt"),d=r.n(p),f="http://127.0.0.1:8000",h=function(){return d.a.get(f+"/app_platforms")},_=function(){return d.a.get(f+"/app_servers")},g=function(){return d.a.get(f+"/welfares/")},b=function(){return d.a.get(f+"/role_players/")},v=function(){return d.a.get(f+"/app_channels/")},y=function(){return d.a.get(f+"/app_managements/")},F=function(e){return d.a.get(f+"/server_managements?cid="+e.cid+"&appid="+e.appid)},w={name:"Home",data:function(){return{userPermissions:{is_applicant:!1,is_approver:!1,is_record_checker:!1,is_role_manager:!1,is_open_zone_viewer:!1,is_open_zone_manager:!1,is_recommend_zone_manager:!1}}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},handleOpen:function(e,t){},handleClose:function(e,t){}},created:function(){var e,t=this,r=sessionStorage.getItem("userId");(e=r,d.a.get(f+"/user_permissions/"+e)).then(function(e){202===e.status?t.userPermissions=e.data:204===e.status&&(t.alertMessage(e.data,"error"),t.$router.push({path:"login/"}))}).catch(function(e){t.alertMessage("登录失败","warning")})}},k={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",[r("el-header",[r("el-row",[r("el-col",[r("h3",[e._v("Ro运营后台管理")])])],1)],1),e._v(" "),r("el-container",[r("el-aside",{attrs:{width:"300px"}},[r("el-col",[r("h3",[e._v("导航菜单")]),e._v(" "),r("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"1",router:""},on:{open:e.handleOpen,close:e.handleClose}},[r("el-submenu",{attrs:{index:"1"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-menu"}),r("span",[e._v("游戏服务器管理")])]),e._v(" "),e.userPermissions.is_open_zone_viewer?r("el-menu-item",{attrs:{index:"1-1",route:{name:"zone_list"}}},[e._v("开区列表")]):e._e(),e._v(" "),e.userPermissions.is_open_zone_manager?r("el-menu-item",{attrs:{index:"1-2",route:{name:"open_zone"}}},[e._v("开区设置")]):e._e(),e._v(" "),e.userPermissions.is_recommend_zone_manager?r("el-menu-item",{attrs:{index:"1-3",route:{name:"recommend"}}},[e._v("推荐设置")]):e._e()],2),e._v(" "),r("el-submenu",{attrs:{index:"2"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-menu"}),r("span",[e._v("福利发放管理")])]),e._v(" "),e.userPermissions.is_applicant?r("el-menu-item",{attrs:{index:"2-1",route:{name:"apply"}}},[e._v("申请")]):e._e(),e._v(" "),e.userPermissions.is_approver?r("el-menu-item",{attrs:{index:"2-2",route:{name:"examine"}}},[e._v("审批")]):e._e(),e._v(" "),e.userPermissions.is_record_checker?r("el-menu-item",{attrs:{index:"2-3",route:{name:"record"}}},[e._v("福利记录")]):e._e(),e._v(" "),e.userPermissions.is_role_manager?r("el-menu-item",{attrs:{index:"2-4",route:{name:"role_management"}}},[e._v("角色管理")]):e._e()],2)],1)],1)],1),e._v(" "),r("el-main",[r("router-view")],1)],1)],1)},staticRenderFns:[]};var x=r("C7Lr")(w,k,!1,function(e){r("VmmV")},"data-v-6cc9da58",null).exports,z={name:"Login",data:function(){return{logining:!1,loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}]},checked:!0}},beforeRouteEnter:function(e,t,r){r(function(e){e.$store.dispatch("setUser",null)})},methods:{handleReset:function(){this.$refs.loginForm.resetFields()},handleSubmit:function(){var e=this;this.$refs.loginForm.validate(function(t){if(!t)return!1;var r;e.logining=!0,(r=e.loginForm,d.a.post(f+"/login",r)).then(function(t){var r=t.data;if(1===r.code){e.$message.success({message:r.message,showClose:!0});var a=r.user_info;sessionStorage.setItem("userId",a.user_id),sessionStorage.setItem("userName",a.username),sessionStorage.setItem("userToken",r.token),e.$store.dispatch("setUser",a),e.$store.dispatch("setToken",r.token),e.$router.push({path:"/"})}else 0===r.code&&e.$message({message:r.message,showClose:!0,type:"error"});e.logining=!1}).catch(function(e){})})}}},P={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-col",{attrs:{offset:9,span:6}},[r("el-form",{ref:"loginForm",staticClass:"demo-ruleForm login-container",attrs:{model:e.loginForm,rules:e.rules,"label-position":"left","label-width":"0px"}},[r("h3",{staticClass:"title"},[e._v("ro运营管理工具登录")]),e._v(" "),r("el-form-item",{attrs:{prop:"username"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"账号"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),e._v(" "),r("el-checkbox",{staticClass:"remember",attrs:{checked:""},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("记住密码")]),e._v(" "),r("el-form-item",{staticStyle:{width:"100%","margin-top":"20px"}},[r("el-button",{attrs:{type:"primary",loading:e.logining},nativeOn:{click:function(t){return t.preventDefault(),e.handleSubmit(t)}}},[e._v("登录\n      ")]),e._v(" "),r("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return t.preventDefault(),e.handleReset(t)}}},[e._v("重置")])],1)],1)],1)},staticRenderFns:[]};var T=r("C7Lr")(z,P,!1,function(e){r("hfd9")},"data-v-0edf9a39",null).exports,S={name:"Apply",data:function(){return{platformOptions:[],zoneOptions:[],roleNameOptions:[],newApplyForm:{pid:"",zid:"",role_name:"",applicant_id:0,amount:"",is_regular:!1,regular_period:0},newApplyFormRules:{pid:[{required:!0,message:"请选择游戏平台",trigger:"change"}],zid:[{required:!0,message:"请选择游戏区服",trigger:"change"}],role_name:[{required:!0,message:"请输入游戏角色名",trigger:"blur"}],amount:[{required:!0,message:"请输入申请数量"},{type:"number",message:"必须为数字值"},{pattern:/^\d{1,3}$/,message:"输入范围1-999"}],regular_period:[{required:!0,message:"请输入固定周期"},{type:"number",message:"必须为数字值"},{pattern:/^\d{1,3}$/,message:"输入范围1-999"}]},newApplyFormLabelPosition:"left",newApplyFormVisible:!1,applyTableData:[],search:""}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},clickAdd:function(){this.newApplyFormVisible=!0},isRegularChange:function(e){this.newApplyForm.regularPeriod=0},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){var r;e&&(t.newApplyForm.applicant_id=Number(sessionStorage.getItem("userId")),(r=t.newApplyForm,d.a.post(f+"/welfares/",r)).then(function(e){201===e.status&&(t.applyTableData.push(e.data),t.alertMessage("添加申请成功","success"))}).catch(function(e){t.alertMessage(e.message,"error")}),t.newApplyFormVisible=!1)})},resetForm:function(e){this.$refs[e].resetFields()},handleChangePlatform:function(e){var t=this;_().then(function(e){var r=e.data;t.zoneOptions=r.filter(function(e){return 50===e.gid&&e.pid===t.newApplyForm.pid})})},handleChangeZone:function(e){var t=this;b().then(function(e){var r=e.data;t.roleNameOptions=r.filter(function(e){return e.pid===t.newApplyForm.pid&&e.zid===t.newApplyForm.zid})})},handleDelete:function(e,t){var r=this;if(0!==t.status)return this.alertMessage("只能撤销审核中的申请","warning"),!1;this.$confirm("撤销申请后将无法恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e;(e=t.id,d.a.delete(f+"/welfares/"+e+"/")).then(function(e){204===e.status?(r.applyTableData=r.applyTableData.filter(function(e){return e.id!==t.id}),r.alertMessage("撤销成功","success")):202===e.status&&r.alertMessage(e.data,"warning")}).catch(function(e){r.alertMessage(e.message,"error")})}).catch(function(){})},dateFormatter:function(e,t,r,a){return r?r.replace("T"," "):"/"},boolFormatter:function(e,t,r,a){return r?"是":"否"},nullFormatter:function(e,t,r,a){return r||"/"},applyStatusFormatter:function(e,t,r,a){return 0===r?"审核中":1===r?"已通过":2===r?"未通过":void 0}},created:function(){var e=this;g().then(function(t){var r=t.data;e.applyTableData=r.filter(function(e){return e.applicant_id===Number(sessionStorage.getItem("userId"))&&0===e.status})}).catch(function(e){}),h().then(function(t){var r=t.data;e.platformOptions=r.filter(function(e){return 50===e.gid&&e.pid>0})}).catch(function(e){})}},$={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-button",{staticStyle:{float:"left","margin-bottom":"20px"},attrs:{type:"primary"},on:{click:e.clickAdd}},[e._v("新增申请")]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applyTableData.filter(function(t){return!e.search||t.role_name.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:""}},[e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"平台名",prop:"pname",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zname",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"角色名",prop:"role_name",align:"center","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"是否固定发放",prop:"is_regular",align:"center",formatter:e.boolFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"固定发放周期(天)",prop:"regular_period",align:"center",formatter:e.nullFormatter,"min-width":"120",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请数量",prop:"amount",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"申请人",prop:"applicant_name",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请日期",prop:"created_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态",prop:"status",align:"center",formatter:e.applyStatusFormatter,sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"审核人",prop:"approver_name",align:"center",formatter:e.nullFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核日期",prop:"approve_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("撤销")])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{title:"新增申请",visible:e.newApplyFormVisible,width:"30%",center:""},on:{"update:visible":function(t){e.newApplyFormVisible=t}}},[r("el-form",{ref:"newApplyForm",staticStyle:{width:"100%","margin-top":"30px"},attrs:{model:e.newApplyForm,rules:e.newApplyFormRules,"label-width":"140px","label-position":e.newApplyFormLabelPosition}},[r("el-form-item",{attrs:{label:"游戏平台",prop:"pid"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择游戏平台"},on:{change:e.handleChangePlatform},model:{value:e.newApplyForm.pid,callback:function(t){e.$set(e.newApplyForm,"pid",t)},expression:"newApplyForm.pid"}},e._l(e.platformOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.pname,value:e.pid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"游戏区服",prop:"zid"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择游戏区服"},on:{change:e.handleChangeZone},model:{value:e.newApplyForm.zid,callback:function(t){e.$set(e.newApplyForm,"zid",t)},expression:"newApplyForm.zid"}},e._l(e.zoneOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.sname,value:e.sid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"角色名",prop:"role_name"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择游戏角色名"},model:{value:e.newApplyForm.role_name,callback:function(t){e.$set(e.newApplyForm,"role_name",t)},expression:"newApplyForm.role_name"}},e._l(e.roleNameOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.role_name,value:e.role_name}})}),1)],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"申请人id",prop:"applicant_id"}},[r("el-input",{attrs:{placeholder:"请输入申请人名"},model:{value:e.newApplyForm.applicant_id,callback:function(t){e.$set(e.newApplyForm,"applicant_id",t)},expression:"newApplyForm.applicant_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"申请数量",prop:"amount"}},[r("el-input",{attrs:{placeholder:"请输入0-999间的整数"},model:{value:e.newApplyForm.amount,callback:function(t){e.$set(e.newApplyForm,"amount",e._n(t))},expression:"newApplyForm.amount"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"是否固定发放"}},[r("el-switch",{on:{change:e.isRegularChange},model:{value:e.newApplyForm.is_regular,callback:function(t){e.$set(e.newApplyForm,"is_regular",t)},expression:"newApplyForm.is_regular"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.newApplyForm.is_regular,expression:"newApplyForm.is_regular"}],attrs:{label:"固定发放周期(天)",prop:"regular_period"}},[r("el-input",{attrs:{placeholder:"请输入0-999间的整数"},model:{value:e.newApplyForm.regular_period,callback:function(t){e.$set(e.newApplyForm,"regular_period",e._n(t))},expression:"newApplyForm.regular_period"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("newApplyForm")}}},[e._v("提交申请")]),e._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.resetForm("newApplyForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]};var O=r("C7Lr")(S,$,!1,function(e){r("PfkX")},"data-v-1e8ecb20",null).exports,C=r("aA9S"),q=r.n(C),M={name:"Examine",data:function(){return{examineTableData:[],search:""}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},handleExamine:function(e,t,r){var a=this;if(0!==t.status)return this.alertMessage("只能对审核中的申请做修改","warning"),!1;this.$confirm("修改申请状态后将无法修改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e;q()(t,{status:r,approver_id:Number(sessionStorage.getItem("userId"))}),(e=t,d.a.put(f+"/welfares/"+e.id+"/",e)).then(function(e){a.examineTableData=a.examineTableData.filter(function(t){return t.id!==e.data.id})}).catch(function(e){}),1===r?a.alertMessage("已批准","success"):2===r&&a.alertMessage("已否决","success")}).catch(function(){})},dateFormatter:function(e,t,r,a){return r?r.replace("T"," "):"/"},boolFormatter:function(e,t,r,a){return r?"是":"否"},nullFormatter:function(e,t,r,a){return r||"/"},applyStatusFormatter:function(e,t,r,a){return 0===r?"审核中":1===r?"已通过":2===r?"未通过":void 0}},created:function(){var e=this;g().then(function(t){e.examineTableData=t.data.filter(function(e){return 0===e.status})}).catch(function(e){})}},R={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.examineTableData.filter(function(t){return!e.search||t.role_name.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:""}},[e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"平台名",prop:"pname",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zname",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"角色名",prop:"role_name",align:"center","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"是否固定发放",prop:"is_regular",align:"center",formatter:e.boolFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"固定发放周期(天)",prop:"regular_period",align:"center",formatter:e.nullFormatter,"min-width":"120",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请数量",prop:"amount",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"申请人",prop:"applicant_name",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请日期",prop:"created_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态",prop:"status",align:"center",formatter:e.applyStatusFormatter,sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"审核人",prop:"approver_name",align:"center",formatter:e.nullFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核日期",prop:"approve_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.handleExamine(t.$index,t.row,1)}}},[e._v("批准")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleExamine(t.$index,t.row,2)}}},[e._v("否决")])]}}])})],1)},staticRenderFns:[]};var A=r("C7Lr")(M,R,!1,function(e){r("K7ZN")},"data-v-653f02f5",null).exports,D={name:"Record",data:function(){return{welfareRecordTableData:[],search:""}},methods:{dateFormatter:function(e,t,r,a){return r?r.replace("T"," "):"/"},boolFormatter:function(e,t,r,a){return r?"是":"否"},nullFormatter:function(e,t,r,a){return r||"/"},applyStatusFormatter:function(e,t,r,a){return 0===r?"审核中":1===r?"已通过":2===r?"未通过":void 0}},created:function(){var e=this;g().then(function(t){sessionStorage.getItem("isApplicant")&&(e.welfareRecordTableData=t.data.filter(function(e){return 0!==e.status&&e.applicant_id===Number(sessionStorage.getItem("userId"))})),sessionStorage.getItem("isApprover")&&(e.welfareRecordTableData=t.data.filter(function(e){return 0!==e.status}))}).catch(function(e){})}},L={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.welfareRecordTableData.filter(function(t){return!e.search||t.role_name.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:""}},[e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"平台名",prop:"pname",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zname",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"角色名",prop:"role_name",align:"center","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"是否固定发放",prop:"is_regular",align:"center",formatter:e.boolFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"固定发放周期(天)",prop:"regular_period",align:"center",formatter:e.nullFormatter,"min-width":"120",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请数量",prop:"amount",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"申请人",prop:"applicant_name",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"申请日期",prop:"created_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核状态",prop:"status",align:"center",formatter:e.applyStatusFormatter,sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"审核人",prop:"approver_name",align:"center",formatter:e.nullFormatter,"min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"审核日期",prop:"approve_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}}])})],1)},staticRenderFns:[]};var I=r("C7Lr")(D,L,!1,function(e){r("Quut")},"data-v-28c9290b",null).exports,V={name:"RolePlayer",data:function(){return{rolePlayerTableData:[],search:"",platformOptions:[],zoneOptions:[],rolePlayerFormTitle:"",rolePlayerFormVisible:!1,rolePlayerFormLabelPosition:"left",rolePlayerForm:{id:"",pid:"",zid:"",role_name:"",user_name:"",is_active:!0,creator_id:0},rolePlayerFormRules:{pid:[{required:!0,message:"请选择游戏平台",trigger:"change"}],zid:[{required:!0,message:"请选择游戏区服",trigger:"change"}],role_name:[{required:!0,message:"请输入游戏角色名"}],user_name:[{required:!0,message:"请输入使用人"}]}}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},clickAdd:function(){this.rolePlayerFormTitle="新增人员角色",this.rolePlayerForm.id="",this.rolePlayerFormVisible=!0},handleEdit:function(e,t){this.rolePlayerFormTitle="编辑人员角色",this.rolePlayerFormVisible=!0,this.rolePlayerForm.id=t.id,this.rolePlayerForm.pid=t.pid,this.rolePlayerForm.zid=t.zid,this.rolePlayerForm.role_name=t.role_name,this.rolePlayerForm.user_name=t.user_name,this.rolePlayerForm.is_active=t.is_active},handleDelete:function(e,t){var r=this;this.$confirm("删除人员角色后将无法恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e;(e=t.id,d.a.delete(f+"/role_players/"+e+"/")).then(function(e){204===e.status&&(r.rolePlayerTableData=r.rolePlayerTableData.filter(function(e){return e.id!==t.id}),r.alertMessage("删除成功","success"))}).catch(function(e){})}).catch(function(){})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){var r;e&&(t.rolePlayerForm.creator_id=Number(sessionStorage.getItem("userId")),t.rolePlayerForm.id?(r=t.rolePlayerForm,d.a.put(f+"/role_players/"+r.id+"/",r)).then(function(e){202===e.status?t.alertMessage(e.data,"warning"):(q()(t.rolePlayerTableData.find(function(e){return e.id===t.rolePlayerForm.id}),e.data),t.alertMessage("修改人员角色成功","success"),t.rolePlayerFormVisible=!1)}):function(e){return d.a.post(f+"/role_players/",e)}(t.rolePlayerForm).then(function(e){201===e.status?(t.rolePlayerTableData.push(e.data),t.alertMessage("添加人员角色成功","success"),t.rolePlayerFormVisible=!1):202===e.status&&t.alertMessage(e.data,"warning")}).catch(function(e){t.alertMessage(e.message,"error")}))})},resetForm:function(e){this.$refs[e].resetFields()},handleChangePlatform:function(e){var t=this,r=e;_().then(function(e){var a=e.data;t.zoneOptions=a.filter(function(e){return 50===e.gid&&e.pid===r})})},dateFormatter:function(e,t,r,a){return r?r.replace("T"," "):"/"},boolFormatter:function(e,t,r,a){return r?"是":"否"},nullFormatter:function(e,t,r,a){return r||"/"},applyStatusFormatter:function(e,t,r,a){return 0===r?"审核中":1===r?"已通过":2===r?"未通过":void 0}},created:function(){var e=this;b().then(function(t){e.rolePlayerTableData=t.data}).catch(function(e){}),h().then(function(t){var r=t.data;e.platformOptions=r.filter(function(e){return 50===e.gid&&e.pid>0})}).catch(function(e){})}},E={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-button",{staticStyle:{float:"left","margin-bottom":"20px"},attrs:{type:"primary"},on:{click:e.clickAdd}},[e._v("新增人员角色")]),e._v(" "),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolePlayerTableData.filter(function(t){return!e.search||t.role_name.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:""}},[e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"平台名",prop:"pname",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zname",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"角色名",prop:"role_name",align:"center","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"使用人",prop:"user_name",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"是否激活",prop:"is_active",align:"center",formatter:e.boolFormatter,sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"修改人",prop:"creator_name",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"修改日期",prop:"modify_date",align:"center",formatter:e.dateFormatter,"min-width":"150","show-overflow-tooltip":"",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{title:e.rolePlayerFormTitle,visible:e.rolePlayerFormVisible,width:"30%",center:""},on:{"update:visible":function(t){e.rolePlayerFormVisible=t}}},[r("el-form",{ref:"rolePlayerForm",staticStyle:{width:"100%","margin-top":"30px"},attrs:{model:e.rolePlayerForm,rules:e.rolePlayerFormRules,"label-width":"140px","label-position":e.rolePlayerFormLabelPosition}},[r("el-form-item",{attrs:{label:"游戏平台",prop:"pid"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择游戏平台"},on:{change:e.handleChangePlatform},model:{value:e.rolePlayerForm.pid,callback:function(t){e.$set(e.rolePlayerForm,"pid",t)},expression:"rolePlayerForm.pid"}},e._l(e.platformOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.pname,value:e.pid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"游戏区服",prop:"zid"}},[r("el-select",{attrs:{filterable:"",placeholder:"请选择游戏区服"},model:{value:e.rolePlayerForm.zid,callback:function(t){e.$set(e.rolePlayerForm,"zid",t)},expression:"rolePlayerForm.zid"}},e._l(e.zoneOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.sname,value:e.sid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"角色名",prop:"role_name"}},[r("el-input",{attrs:{placeholder:"请输入角色名"},model:{value:e.rolePlayerForm.role_name,callback:function(t){e.$set(e.rolePlayerForm,"role_name",t)},expression:"rolePlayerForm.role_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"使用人",prop:"user_name"}},[r("el-input",{attrs:{placeholder:"请输入使用人"},model:{value:e.rolePlayerForm.user_name,callback:function(t){e.$set(e.rolePlayerForm,"user_name",t)},expression:"rolePlayerForm.user_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"是否激活"}},[r("el-switch",{model:{value:e.rolePlayerForm.is_active,callback:function(t){e.$set(e.rolePlayerForm,"is_active",t)},expression:"rolePlayerForm.is_active"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("rolePlayerForm")}}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.resetForm("rolePlayerForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]};var N=r("C7Lr")(V,E,!1,function(e){r("SLw1")},"data-v-5ea6981b",null).exports,U={name:"ZoneList",data:function(){return{channelOptions:[],packageOptions:[],recommendOptions:[{value:0,label:"否"},{value:1,label:"是"}],openTypeOptions:[{value:0,label:"立即开区"},{value:1,label:"按人数开区"},{value:2,label:"按时间开区"}],queryForm:{gid:50,cid:"",appid:""},queryFormRules:{cid:[{required:!0,message:"请选择游戏渠道",trigger:"change"}]},openFormLabelPosition:"left",openFormVisible:!1,openForm:{open_type:0,max_users:0,autoOpenTime:0,by_zone:!1},openFormRules:{max_users:[{type:"number",message:"必须为数字值"},{pattern:/^\d{1,4}$/,message:"输入范围1-9999"}],autoOpenTime:[{type:"date",message:"请选择日期"}]},editFormLabelPosition:"left",editFormVisible:!1,editForm:{id:0,zoneidx:"",server_suggest:0,max_users:"",server_weight:"",autoOpenTime:"",by_zone:!1},editFormRules:{max_users:[{required:!0,message:"请输入最大用户数"},{type:"number",message:"必须为数字值"},{pattern:/^\d{1,4}$/,message:"输入范围1-9999"}],server_weight:[{required:!0,message:"请输入服务器权重"},{type:"number",message:"必须为数字值"},{pattern:/^\d$/,message:"输入范围1-9"}],autoOpenTime:[{type:"date",required:!0,message:"请选择日期"}]},serverManagementTableData:[],search:"",multipleSelection:[],byUser:!1,byTime:!1}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},openTypeFormatter:function(e,t,r,a){var n="";switch(r){case 0:n="立即开区";break;case 1:n="按时间开区";break;case 2:n="按人数开区";break;default:n="未开启"}return n},openTypeTimeFormatter:function(e,t,r,a){if(null!==r)return this.timeStampFormatter("","",r,"")},timeStampFormatter:function(e,t,r,a){var n=new Date(1e3*r);return n.getFullYear()+"-"+((n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"-")+(n.getDate()+" ")+(n.getHours()+":")+(n.getMinutes()+":")+n.getSeconds()},serverSuggestFormatter:function(e,t,r,a){var n="";switch(r){case 0:n="否";break;case 1:n="是";break;default:n="未知"}return n},serverStatuFormatter:function(e,t,r,a){var n="";switch(r){case 101:n="新区";break;case 102:n="畅通";break;case 103:n="拥挤";break;case 104:n="繁忙";break;case 105:n="未开";break;case 111:n="例行维护";break;case 112:n="临时维护";break;case 113:n="数据互通";break;case 201:n="内部测试服";break;case 202:n="待开放新区";break;default:n="未知"}return n},getRowKeys:function(e){return e.id},handleSelectionChange:function(e){this.multipleSelection=e},clearSelect:function(){this.multipleSelection=[]},handleOpen:function(){if(this.multipleSelection.length<1)return this.alertMessage("请先查询区服并勾选","warning"),!1;this.openFormVisible=!0},changeOpenType:function(e){switch(this.openForm.max_users=0,this.openForm.autoOpenTime=0,e){case 0:this.byUser=this.byTime=!1;break;case 1:this.byUser=!0,this.byTime=!this.byUser;break;case 2:this.byUser=!1,this.byTime=!this.byUser}},handleChangeChannel:function(e){var t=this;if(!e)return this.packageOptions=[],this.queryForm.appid="",!1;y().then(function(e){t.packageOptions=e.data}).catch(function(e){})},handleChangePackage:function(e){},onSubmit:function(e){var t=this;this.$refs[e].validate(function(r){r&&F(t[e]).then(function(e){var r=e.data;t.serverManagementTableData=r}).catch(function(e){})})},openNow:function(e,t){var r=this;if(null!==t.open_type)return this.alertMessage("无法对已开区执行立即开区操作","error"),!1;this.$confirm("立即开区将即刻生效，且无法修改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e;(e=t,d.a.post(f+"/open_now/"+e.id+"/",e)).then(function(e){q()(r.serverManagementTableData.find(function(e){return e.id===t.id}),e.data),r.alertMessage("立即开区成功","success")}).catch(function(e){r.alertMessage("立即开区失败","error")})}).catch(function(){})},handleClickSelectPackage:function(e){var t=this;if(!e)return this.packageOptions=[],this.queryForm.appid="",!1;y().then(function(e){var r=e.data;t.packageOptions=r}).catch(function(e){})}},created:function(){var e=this;v().then(function(t){e.channelOptions=t.data}).catch(function(e){})}},B={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"queryForm",staticStyle:{float:"left"},attrs:{inline:!0,rules:e.queryFormRules,model:e.queryForm}},[r("el-form-item",{attrs:{label:"渠道",prop:"cid"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏渠道"},on:{change:e.handleChangeChannel},model:{value:e.queryForm.cid,callback:function(t){e.$set(e.queryForm,"cid",t)},expression:"queryForm.cid"}},e._l(e.channelOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.cname,value:e.cid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"包"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏包"},on:{change:e.handleChangePackage},model:{value:e.queryForm.appid,callback:function(t){e.$set(e.queryForm,"appid",t)},expression:"queryForm.appid"}},e._l(e.packageOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.appid,value:e.appid}})}),1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("queryForm")}}},[e._v("查询")])],1)],1),e._v(" "),r("el-table",{ref:"serverManagementTableData",staticStyle:{width:"100%"},attrs:{data:e.serverManagementTableData.filter(function(t){return!e.search||t.zonename.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:"","row-key":e.getRowKeys},on:{"selection-change":e.handleSelectionChange}},[e._e(),e._v(" "),e._e(),e._v(" "),e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zonename",align:"center",sortable:""}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"服务器状态",prop:"server_statu",align:"center",formatter:e.serverStatuFormatter,sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"是否推荐",prop:"server_suggest",align:"center",formatter:e.serverSuggestFormatter,sortable:""}}),e._v(" "),e._e(),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"开区时间",prop:"OpenDate",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"合区时间",prop:"MergeDate",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"合区id",prop:"MergeID",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"appid",prop:"appid",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"开区类型",prop:"open_type",align:"center","min-width":"100",formatter:e.openTypeFormatter,sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"本区预计开区时间",prop:"open_time",align:"center","min-width":"120",formatter:e.openTypeTimeFormatter,sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"本区人数上限",prop:"max_user",align:"center","min-width":"100",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入区服名搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return null===t.row.open_type?[r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.openNow(t.$index,t.row)}}},[e._v("立即开区")])]:void 0}}],!0)})],1)],1)},staticRenderFns:[]};var Z=r("C7Lr")(U,B,!1,function(e){r("B/tY")},"data-v-2103f1d4",null).exports,H={name:"Recommend",data:function(){return{channelOptions:[],packageOptions:[],zoneOptions:[],queryForm:{gid:50,cid:"",appid:""},queryFormRules:{cid:[{required:!0,message:"请选择渠道",trigger:"change"}],appid:[{required:!0,message:"请选择包",trigger:"change"}]},recommendServerManagementTableData:[],search:"",multiRecommendFormVisible:!1,multiRecommendFormLabelPosition:"right",multiSelectedZone:[],multiRecommendForm:{gid:50,cid:"",appid:"",zones:[]}}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},onQuery:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var r;(r=t.queryForm,d.a.get(f+"/recommend_server_managements?cid="+r.cid+"&appid="+r.appid)).then(function(e){t.recommendServerManagementTableData=e.data,t.multiRecommendForm.cid=t.queryForm.cid,t.multiRecommendForm.appid=t.queryForm.appid}).catch(function(e){})})},handleChangeChannel:function(e){var t=this;if(!e)return this.packageOptions=[],this.queryForm.appid="",!1;y().then(function(e){var r=e.data;t.packageOptions=r}).catch(function(e){})},setRecommend:function(e,t,r){var a=this;(function(e){return d.a.post(f+"/change_recommend/"+e.id+"/",e)})({id:t.id,server_suggest:r}).then(function(e){var t=e.data;a.recommendServerManagementTableData=t,a.alertMessage("修改推荐状态成功","success")}).catch(function(e){a.alertMessage("修改推荐状态失败","error")})},handleSelectionChange:function(e){this.multiSelectedZone=e},clickMultiRecommend:function(){var e=this;this.multiSelectedZone.length<2?this.alertMessage("多区推荐至少需要勾选2个区","error"):(this.multiRecommendForm.zones=[],this.multiSelectedZone.map(function(t){return e.multiRecommendForm.zones.push({id:t.id,zonename:t.zonename,server_weight:t.server_weight})}),this.multiRecommendFormVisible=!0)},setWeight:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$confirm("设置权重推荐将立刻生效, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e;(e=t.multiRecommendForm,d.a.post(f+"/weight_recommend/",e)).then(function(e){var r=e.data;t.recommendServerManagementTableData=r,t.alertMessage("设置多区权重推荐成功","success")}).catch(function(e){t.alertMessage("设置多区权重推荐失败","error")}),t.multiRecommendFormVisible=!1}).catch(function(){})})},serverSuggestFormatter:function(e,t,r,a){var n="";switch(r){case 0:n="不推荐";break;case 1:n=null!==e.server_weight&&""!==e.server_weight?"权重推荐":"手动推荐";break;default:n="未知"}return n}},created:function(){var e=this;v().then(function(t){e.channelOptions=t.data}).catch(function(e){})}},Q={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:e.clickMultiRecommend}},[e._v("多区推荐")]),e._v(" "),r("el-form",{ref:"queryForm",attrs:{inline:!0,model:e.queryForm,rules:e.queryFormRules}},[r("el-form-item",{attrs:{label:"渠道",prop:"cid"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏渠道"},on:{change:e.handleChangeChannel},model:{value:e.queryForm.cid,callback:function(t){e.$set(e.queryForm,"cid",t)},expression:"queryForm.cid"}},e._l(e.channelOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.cname,value:e.cid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"包",prop:"appid"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏包"},model:{value:e.queryForm.appid,callback:function(t){e.$set(e.queryForm,"appid",t)},expression:"queryForm.appid"}},e._l(e.packageOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.appid,value:e.appid}})}),1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onQuery("queryForm")}}},[e._v("查询")])],1)],1),e._v(" "),r("el-table",{ref:"serverManagementTableData",staticStyle:{width:"100%"},attrs:{data:e.recommendServerManagementTableData.filter(function(t){return!e.search||t.zonename.toLowerCase().includes(e.search.toLowerCase())}),size:"small",border:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._e(),e._v(" "),r("el-table-column",{attrs:{label:"区服名",prop:"zonename",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"包id",prop:"appid",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"开区时间",prop:"OpenDate",align:"center",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{label:"推荐方式",prop:"server_suggest",formatter:e.serverSuggestFormatter,align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"推荐权重",prop:"server_weight",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{"min-width":"200",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[r("el-input",{attrs:{size:"mini",placeholder:"输入区服名搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})]}},{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.setRecommend(t.$index,t.row,1)}}},[e._v("设为默认推荐")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return e.setRecommend(t.$index,t.row,0)}}},[e._v("设为默认不推荐")])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{title:"多区权重推荐设置",visible:e.multiRecommendFormVisible,width:"30%",center:""},on:{"update:visible":function(t){e.multiRecommendFormVisible=t}}},[r("el-form",{ref:"multiRecommendForm",attrs:{model:e.multiRecommendForm,"label-position":e.multiRecommendFormLabelPosition,"label-width":"100px"}},[e._l(e.multiRecommendForm.zones,function(t,a){return r("div",{key:t.id},[e._e(),e._v(" "),r("el-form-item",{attrs:{label:"区服名",prop:"zones."+a+".zonename"}},[r("el-input",{attrs:{readonly:""},model:{value:t.zonename,callback:function(r){e.$set(t,"zonename",r)},expression:"zone.zonename"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"推荐权重",prop:"zones."+a+".server_weight",rules:[{required:!0,message:"推荐权重不能为空"},{type:"number",message:"必须为数字值"},{pattern:/^\d$/,message:"输入范围1-9"}]}},[r("el-input",{attrs:{placeholder:"服务器权重数1~9"},model:{value:t.server_weight,callback:function(r){e.$set(t,"server_weight",e._n(r))},expression:"zone.server_weight"}})],1)],1)}),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.preventDefault(),e.setWeight("multiRecommendForm")}}},[e._v("确定")])],1)],2)],1)],1)},staticRenderFns:[]};var X=r("C7Lr")(H,Q,!1,function(e){r("64/T")},"data-v-0e60b656",null).exports,j={name:"OpenZone",data:function(){return{channelOptions:[],packageOptions:[],zoneOptions:[],recommendOptions:[{value:0,label:"否"},{value:1,label:"是"}],openTypeOptions:[{value:1,label:"按人数开区"},{value:2,label:"按时间开区"}],queryForm:{gid:50,cid:"",appid:""},queryFormRules:{cid:[{required:!0,message:"请选择渠道",trigger:"change"}],appid:[{required:!0,message:"请选择包",trigger:"change"}]},planForm:{gid:50,cid:"",appid:"",plans:[]},pickerOptions:{disabledDate:function(e){var t=new Date;return e.getTime()<new Date(t.setDate(t.getDate()-1))}}}},methods:{alertMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},handleChangeChannel:function(e){var t=this;if(!e)return this.packageOptions=[],this.queryForm.appid="",!1;y().then(function(e){var r=e.data;t.packageOptions=r}).catch(function(e){})},changeSwitch:function(e){this.zoneOptions.find(function(t){return t.id===e.id}).sync||(this.alertMessage("该区默认配置为不同步，无法修改为同步","error"),e.by_zone=!1)},addPlan:function(){if(this.planForm.plans.length>=this.zoneOptions.length)this.alertMessage("已无可设置计划的区服","warning");else{if(this.planForm.plans.length>=1)if(!this.planForm.plans[this.planForm.plans.length-1].planned)return this.alertMessage("请先保存上一个区的配置","error"),!1;var e=this.zoneOptions.filter(function(e){return!(e.open_time||e.max_user)})[0];this.planForm.plans.push({id:e.id,zoneidx:e.zoneidx,zonename:e.zonename,open_type:e.open_type,max_user:e.max_user,open_time:e.open_time,by_zone:e.sync,planned:!1,key:Date.now()})}},savePlan:function(e,t){var r=this;this.$refs[e].validate(function(e){if(!e)return!1;r.$confirm("保存计划后立刻生效, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(!t.open_time&&!t.max_user)return r.alertMessage("开区时间和人数上限不能都为空","error"),!1;var e;(e=t,d.a.post(f+"/set_open_plan/"+e.id+"/",e)).then(function(e){if(204===e.status)return r.alertMessage("该区已开服，请重新查询区服列表,","error"),!1;e.data;t.planned=!0,r.alertMessage("设置开区计划成功","success")}).catch(function(e){r.alertMessage("设置开区计划失败","error")})}).catch(function(){})})},removePlan:function(e){var t=this;this.$confirm("删除计划后无法恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r;(r=e,d.a.post(f+"/delete_open_plan/"+r.id+"/",r)).then(function(r){t.planForm.plans.pop(t.planForm.plans.find(function(t){return t.id===e.id})),t.alertMessage("删除开区计划成功","success")}).catch(function(e){t.alertMessage("删除开区计划失败","error")})}).catch(function(){})},handleChangeZone:function(e){this.planForm.plans.filter(function(t){return t.id===e.id}).length>1?(this.alertMessage("当前区服已存在计划任务，无法重复创建","error"),e.id=""):(e.zoneidx=this.zoneOptions.find(function(t){return t.id===e.id}).zoneidx,e.zonename=this.zoneOptions.find(function(t){return t.id===e.id}).zonename)},handleChangeOpenType:function(e){1===e.open_type?e.open_time=e.open_time?e.open_time:0:2===e.open_type&&(e.max_user=e.max_user?e.max_user:0)},onQuery:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;F(t.queryForm).then(function(e){var r=e.data;t.zoneOptions=r.filter(function(e){return e.server_statu>200}),t.planForm.plans=[],t.zoneOptions.map(function(e){(e.open_time||e.max_user)&&t.planForm.plans.push({id:e.id,zoneidx:e.zoneidx,zonename:e.zonename,open_type:e.open_type,open_time:1e3*e.open_time,max_user:e.max_user,by_zone:e.sync,planned:!0})})}).catch(function(e){})})},submitForm:function(e){this.$refs[e].validate(function(e){if(!e)return!1;alert("submit!")})}},created:function(){var e=this;v().then(function(t){e.channelOptions=t.data}).catch(function(e){})}},K={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{float:"left"}},[r("el-form",{ref:"queryForm",attrs:{inline:!0,model:e.queryForm,rules:e.queryFormRules}},[r("el-form-item",{attrs:{label:"渠道",prop:"cid"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏渠道"},on:{change:e.handleChangeChannel},model:{value:e.queryForm.cid,callback:function(t){e.$set(e.queryForm,"cid",t)},expression:"queryForm.cid"}},e._l(e.channelOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.cname,value:e.cid}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"包",prop:"appid"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择游戏包"},model:{value:e.queryForm.appid,callback:function(t){e.$set(e.queryForm,"appid",t)},expression:"queryForm.appid"}},e._l(e.packageOptions,function(e,t){return r("el-option",{key:t,attrs:{label:e.appid,value:e.appid}})}),1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onQuery("queryForm")}}},[e._v("查询")])],1)],1),e._v(" "),r("el-form",{ref:"planForm",attrs:{model:e.planForm,inline:!0}},[e._l(e.planForm.plans,function(t,a){return r("div",{key:t.key},[r("el-form-item",[r("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.planned,expression:"plan.planned"}],attrs:{type:"success"}},[e._v("已生效")]),e._v(" "),r("el-tag",{directives:[{name:"show",rawName:"v-show",value:!t.planned,expression:"!plan.planned"}],attrs:{type:"danger"}},[e._v("未生效")])],1),e._v(" "),r("el-form-item",{attrs:{label:"区服名",prop:"plans."+a+".id"}},[r("el-input",{attrs:{readonly:""},model:{value:t.zonename,callback:function(r){e.$set(t,"zonename",r)},expression:"plan.zonename"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"开区时间",prop:"plans."+a+".open_time"}},[r("el-date-picker",{attrs:{type:"datetime","value-format":"timestamp",placeholder:"请选择开区时间","picker-options":e.pickerOptions},model:{value:t.open_time,callback:function(r){e.$set(t,"open_time",r)},expression:"plan.open_time"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"人数上限",prop:"plans."+a+".max_user"}},[r("el-input",{attrs:{placeholder:"请输入开区人数"},model:{value:t.max_user,callback:function(r){e.$set(t,"max_user",e._n(r))},expression:"plan.max_user"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"同步到区"}},[r("el-switch",{on:{change:function(r){return e.changeSwitch(t)}},model:{value:t.by_zone,callback:function(r){e.$set(t,"by_zone",r)},expression:"plan.by_zone"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return r.preventDefault(),e.savePlan("planForm",t)}}},[e._v("保存")])],1)],1)}),e._v(" "),r("el-form-item",{staticStyle:{float:"left"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.addPlan}},[e._v("新增计划")])],1)],2)],1)},staticRenderFns:[]};var Y=r("C7Lr")(j,K,!1,function(e){r("pJ0z")},"data-v-5d3cac4c",null).exports;s.default.use(m.a);var J=new m.a({routes:[{path:"/",name:"Home",component:x,children:[{path:"server_management/zone_list",name:"zone_list",component:Z,props:!0},{path:"server_management/open_zone",name:"open_zone",component:Y,props:!0},{path:"server_management/recommend",name:"recommend",component:X,props:!0},{path:"welfare_management/apply",name:"apply",component:O,props:!0},{path:"welfare_management/examine",name:"examine",component:A,props:!0},{path:"welfare_management/record",name:"record",component:I,props:!0},{path:"welfare_management/role_management",name:"role_management",component:N,props:!0}]},{path:"/login",name:"Login",component:T}]});J.beforeEach(function(e,t,r){if("/login"===e.path)r();else{var a=sessionStorage.getItem("userToken");null===a||""===a?r("/login"):r()}});var W=J,G=r("R2wu"),ee=r.n(G),te=(r("XEXE"),r("R4Sj")),re=function(e){return e.currentUser},ae=function(e){return e.isLogin},ne=function(e,t){t?(e.currentUserId=t.user_id,e.currentUser=t.username,e.isLogin=!0):null===t&&(sessionStorage.setItem("userId",null),sessionStorage.setItem("userName",null),sessionStorage.setItem("userToken",""),e.currentUser=null,e.isLogin=!1,e.token="")},oe=function(e,t){e.token=t||null},le=function(e,t){(0,e.commit)("userStatus",t)},ie=function(e,t){(0,e.commit)("userToken",t)};s.default.use(te.a);var se=new te.a.Store({state:{currentUser:null,isLogin:!1,token:""},getters:a,mutations:n,actions:o});s.default.use(ee.a),s.default.prototype.$axios=d.a,s.default.config.productionTip=!1,d.a.interceptors.request.use(function(e){return sessionStorage.getItem("userToken")&&(e.headers.Authorization=sessionStorage.getItem("userToken")),e},function(e){return i.a.reject(e)}),d.a.interceptors.response.use(function(e){return e},function(e){if(e&&e.response)switch(e.response.status){case 400:e.message="请求错误(400)";break;case 401:e.message="未授权，请重新登录(401)";break;case 403:e.message="拒绝访问(403)",W.push({path:"/login"}),Object(G.Message)({showClose:!0,message:"token验证过期, 请重新登录",type:"error"});break;case 404:e.message="请求出错(404)";break;case 408:e.message="请求超时(408)";break;case 500:e.message="服务器错误(500)";break;case 501:e.message="服务未实现(501)";break;case 502:e.message="网络错误(502)";break;case 503:e.message="服务不可用(503)";break;case 504:e.message="网络超时(504)";break;case 505:e.message="HTTP版本不受支持(505)";break;default:e.message="连接出错("+e.response.status+")!"}else e.message="连接服务器失败!";return i.a.reject(e)}),new s.default({el:"#app",router:W,store:se,components:{App:u},template:"<App/>"})},PfkX:function(e,t){},Quut:function(e,t){},SLw1:function(e,t){},VmmV:function(e,t){},XEXE:function(e,t){},hfd9:function(e,t){},pJ0z:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.eba5585685610b758647.js.map